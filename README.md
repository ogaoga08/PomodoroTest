# リマインダーアプリ

UWB 機能を搭載した iOS リマインダーアプリです。タスク管理と UWB による位置情報を組み合わせて、効率的なタスク管理ができます。

## 主な機能

### 📋 タスク管理

- **タスク追加**: タイトル、メモ、期限を設定してタスクを作成
- **タスク表示**: 今日のタスクと明日以降のタスクを分けて表示
- **スワイプ削除**: タスクを左にスワイプして削除
- **期限遂行率**: 完了したタスクの割合を表示

### 📡 UWB 機能

- **Secure Bubble**: UWB 技術による安全なエリア検出
- **リアルタイム距離表示**: UWB デバイスとの距離をリアルタイムで表示
- **部屋状態表示**: Secure Bubble 内/外の状態を視覚的に表示
- **バックグラウンド監視**: 自宅内での自動監視と Screen Time 連動

### 🏠 ジオフェンシング機能

- **自宅位置設定**: 地図から自宅位置を選択
- **自動進入/退出検知**: ジオフェンス範囲の出入りを自動検知
- **UWB 自動再接続**: 帰宅時に UWB デバイスとの接続を自動再開
- **デバッグ通知**: 進入/退出時の通知機能（デバッグ用）

### 🛡️ Screen Time 連動

- **自動制限**: Secure Bubble 内 + 当日タスクありの条件で自動制限
- **タスク時刻条件**: タスクの時刻到来後のみ制限を適用
- **柔軟な設定**: アプリ、カテゴリ、Web ドメインの制限対象を選択可能

### ⚙️ 設定機能

- **UWB モジュール設定**: Nearby Interaction API を使用した UWB デバイス設定
- **ジオフェンス設定**: 自宅位置の設定とデバッグ通知の有効化
- **Screen Time 設定**: 制限対象アプリの選択と UWB 連動状態の確認
- **メニューアクセス**: 右上の 3 点メニューから各種設定へアクセス

## 画面構成

### メイン画面

- 残りのタスク数と期限遂行率を表示
- 今日と明日以降のタスクをセクション分け
- UWB 状態と Secure Bubble 状態の表示
- 右上のメニューボタン
- 左下のタスク追加ボタン（フローティングアクション）

### タスク追加画面

- タスク名の入力
- メモの入力（オプション）
- 期限の Date picker（グラフィカル表示）

### タスク編集画面

- タスク情報の編集
- 削除・完了ボタン

### UWB 設定画面

- UWB モジュールとの接続設定
- Secure Bubble の設定

## 技術仕様

- **フレームワーク**: SwiftUI
- **最小対応バージョン**: iOS 15.0+
- **データ永続化**: UserDefaults
- **UWB 技術**: Nearby Interaction API

## アーキテクチャ

```
PomodoroReminderApp/
├── Models/
│   └── TaskModel.swift          # タスクデータモデルとマネージャー
├── Views/
│   ├── AddTaskView.swift        # タスク追加画面
│   ├── TaskDetailView.swift     # タスク編集画面
│   ├── MenuView.swift           # 設定メニュー画面
│   └── UWBSettingsView.swift    # UWB設定画面
├── ContentView.swift            # メイン画面
└── PomodoroReminderApp.swift   # アプリエントリーポイント
```

## 使用方法

### ⚠️ 重要: 初期設定

ジオフェンス機能を使用する前に、以下の設定が必要です：

1. **位置情報の許可を「常に」に設定**

   ```
   設定 → プライバシー → 位置情報サービス → LocationReminder → 「常に」を選択
   ```

   - ⚠️ 「使用中のみ」では、バックグラウンドでジオフェンス検知できません
   - ジオフェンシング設定画面で現在の許可状態を確認できます
   - 許可が不足している場合は、画面に警告が表示されます

2. **通知の許可**
   - デバッグ通知や進入/退出通知を受け取るには通知許可が必要です

---

### 📋 基本的な使い方

1. **タスクの追加**

   - メイン画面の左下「+」ボタンをタップ
   - タスク名、メモ、期限を入力して「追加」

2. **ジオフェンシング設定**

   - メニュー > ジオフェンシング設定を開く
   - ⚠️ **まず位置情報許可が「常に許可」になっているか確認**
   - 「自宅住所」の「変更」をタップ
   - 地図から自宅位置を選択、または検索で住所を入力
   - 「この位置を選択」→「完了」で設定完了
   - デバッグ通知をオンにすると、進入/退出時に通知が届く

3. **UWB 機能の使用**

   - メイン画面左上の UWB 状態表示をタップ
   - UWB 設定画面でデバイスとの接続を設定
   - Secure Bubble 内/外の状態が自動で表示される
   - 自宅ジオフェンス内で帰宅を検知すると自動で再接続

4. **Screen Time 制限の設定**

   - メニュー > Screen Time 設定を開く
   - 「制限するアプリを選択」をタップ
   - アプリ、カテゴリ、Web ドメインを選択
   - Secure Bubble 内 + 当日タスクありの条件で自動制限

5. **タスクの編集・完了・削除**
   - タスクをタップして編集画面を開く
   - 「完了」でアーカイブに移動
   - 「削除」で完全に削除

---

## 🔧 トラブルシューティング

### ジオフェンスが動作しない

1. **位置情報許可を確認**

   - 設定アプリで「常に許可」になっているか確認
   - アプリ内「ジオフェンシング設定」画面で許可状態をチェック

2. **ジオフェンス検知の仕様を理解**

   - ジオフェンスの検知には**数十メートル以上の移動**が必要です
   - 50m 程度の移動では検知されない場合があります（iOS の仕様）
   - **推奨テスト方法**: 200m 以上離れてから戻る

3. **在宅状態が更新されない**
   - アプリを完全に再起動（スワイプで終了 → 再起動）
   - 自宅位置を再設定して、ジオフェンスを再初期化

詳細なトラブルシューティングは [GEOFENCE_ANALYSIS.md](GEOFENCE_ANALYSIS.md#-トラブルシューティング) を参照してください。

## 今後の実装予定

- [x] ジオフェンシング機能の実装
- [x] Screen Time 連動機能
- [x] デバッグ通知機能
- [ ] ジオフェンス半径の動的調整
- [ ] 複数の自宅・職場位置対応
- [ ] ジオフェンス進入/退出の履歴表示
- [ ] 統計機能の拡張
- [ ] ダークモード対応の改善
- [ ] ウィジェット対応
- [ ] Apple Watch 連携

## 📖 詳細ドキュメント

より詳しい実装の説明とプロセス分析は以下のドキュメントを参照してください：

- [ジオフェンス・UWB・Screen Time 処理プロセス分析](GEOFENCE_ANALYSIS.md)

## ライセンス

このプロジェクトはサンプルコードとして提供されています。
